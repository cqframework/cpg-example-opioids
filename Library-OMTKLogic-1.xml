<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1" localId="0">
   <annotation translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" signatureLevel="Overloads" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="1267">
         <a:s>library OMTKLogic version '0.0.0'</a:s>
      </a:s>
   </annotation>
   <identifier id="OMTKLogic" system="http://cqframework.org/cpg-example-opioids" version="0.0.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localId="1" localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
   </usings>
   <codeSystems>
      <def localId="206" locator="10:1-10:64" name="RxNorm" id="http://www.nlm.nih.gov/research/umls/rxnorm" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>/*
This is a &quot;stub&quot; version of the OMTKLogic library that has no dependencies
on the OMTK data. It provides a workable version of the logic suitable for
example usage. For the full version of this library, see the CDC Opioid
 Prescribing Support Implementation Guide.
*/

codesystem RxNorm: 'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
            </a:s>
         </annotation>
      </def>
   </codeSystems>
   <statements>
      <def localId="207" locator="23:1-30:5" name="ToUCUM" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="207">
               <a:s>/*
  Normalizes the input units to UCUM units

  Note guidance for UCUM presentation of medication units from SNOMED here:
  https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjU3vLpicPTAhWFMGMKHRpOBUAQFggiMAA&amp;url=https%3A%2F%2Fconfluence.ihtsdotools.org%2Fdownload%2Fattachments%2F17859188%2FExpressing%2520Units%2520of%2520Measure%2520for%2520Medicinal%2520Products.doc%3Fapi%3Dv2&amp;usg=AFQjCNE5sboicqvJDUyXJ2im8VzBpgHE8A

  The values listed here are the only ones currently present in the OMTK data

  Based on the HL7 UCUM subset here:
  http://download.hl7.de/documents/ucum/ucumdata.html
*/
define function ToUCUM(unit String):
  </a:s>
               <a:s r="210">
                  <a:s r="210">
                     <a:s>case </a:s>
                     <a:s r="211">
                        <a:s>unit</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="212">
                        <a:s>when </a:s>
                        <a:s r="213">
                           <a:s>'MG'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="214">
                           <a:s>'mg'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="215">
                        <a:s>when </a:s>
                        <a:s r="216">
                           <a:s>'MG/ACTUAT'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="217">
                           <a:s>'mg/{actuat}'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="218">
                        <a:s>when </a:s>
                        <a:s r="219">
                           <a:s>'MG/HR'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="220">
                           <a:s>'mg/h'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="221">
                        <a:s>when </a:s>
                        <a:s r="222">
                           <a:s>'MG/ML'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="223">
                           <a:s>'mg/mL'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else </a:s>
                     <a:s r="234">
                        <a:s r="230">
                           <a:s r="226">
                              <a:s>'Error: unknown{'</a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="227">
                              <a:s>unit</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="231">
                           <a:s>'}'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="210" locator="24:3-30:5" xsi:type="Case">
            <comparand localId="211" locator="24:8-24:11" name="unit" xsi:type="OperandRef"/>
            <caseItem localId="212" locator="25:5-25:23">
               <when localId="213" locator="25:10-25:13" valueType="t:String" value="MG" xsi:type="Literal"/>
               <then localId="214" locator="25:20-25:23" valueType="t:String" value="mg" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="215" locator="26:5-26:39">
               <when localId="216" locator="26:10-26:20" valueType="t:String" value="MG/ACTUAT" xsi:type="Literal"/>
               <then localId="217" locator="26:27-26:39" valueType="t:String" value="mg/{actuat}" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="218" locator="27:5-27:28">
               <when localId="219" locator="27:10-27:16" valueType="t:String" value="MG/HR" xsi:type="Literal"/>
               <then localId="220" locator="27:23-27:28" valueType="t:String" value="mg/h" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="221" locator="28:5-28:29">
               <when localId="222" locator="28:10-28:16" valueType="t:String" value="MG/ML" xsi:type="Literal"/>
               <then localId="223" locator="28:23-28:29" valueType="t:String" value="mg/mL" xsi:type="Literal"/>
            </caseItem>
            <else localId="234" locator="29:10-29:39" xsi:type="Concatenate">
               <operand localId="230" locator="29:10-29:33" xsi:type="Concatenate">
                  <operand localId="226" locator="29:10-29:26" valueType="t:String" value="Error: unknown{" xsi:type="Literal"/>
                  <operand localId="227" locator="29:30-29:33" name="unit" xsi:type="OperandRef"/>
               </operand>
               <operand localId="231" locator="29:37-29:39" valueType="t:String" value="}" xsi:type="Literal"/>
            </else>
         </expression>
         <operand localId="209" name="unit">
            <operandTypeSpecifier localId="208" locator="23:29-23:34" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="235" locator="35:1-45:5" name="ToDaily" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="235">
               <a:s>/*
  Calculates daily frequency given frequency within a period
*/
define function ToDaily(frequency Integer, period System.Quantity):
  </a:s>
               <a:s r="240">
                  <a:s r="240">
                     <a:s>case </a:s>
                     <a:s r="242">
                        <a:s r="241">
                           <a:s>period</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="242">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="243">
                        <a:s>when </a:s>
                        <a:s r="244">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="245">
                           <a:s r="246">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="247">
                              <a:s>(</a:s>
                              <a:s r="247">
                                 <a:s r="248">24.0 / </a:s>
                                 <a:s r="250">
                                    <a:s r="249">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="250">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="258">
                        <a:s>when </a:s>
                        <a:s r="259">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="260">
                           <a:s r="261">
                              <a:s r="262">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="263">
                                 <a:s>(</a:s>
                                 <a:s r="263">
                                    <a:s r="264">24.0 / </a:s>
                                    <a:s r="266">
                                       <a:s r="265">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="266">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="274"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="280">
                        <a:s>when </a:s>
                        <a:s r="281">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="282">
                           <a:s r="283">
                              <a:s r="284">
                                 <a:s r="285">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="286">
                                    <a:s>(</a:s>
                                    <a:s r="286">
                                       <a:s r="287">24.0 / </a:s>
                                       <a:s r="289">
                                          <a:s r="288">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="289">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="297"> * 60</a:s>
                           </a:s>
                           <a:s r="303"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="309">
                        <a:s>when </a:s>
                        <a:s r="310">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="311">
                           <a:s r="312">
                              <a:s r="313">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="314">
                                 <a:s>(</a:s>
                                 <a:s r="314">
                                    <a:s r="315">24.0 / </a:s>
                                    <a:s r="317">
                                       <a:s r="316">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="317">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="325"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="331">
                        <a:s>when </a:s>
                        <a:s r="332">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="333">
                           <a:s r="334">
                              <a:s r="335">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="336">
                                 <a:s>(</a:s>
                                 <a:s r="336">
                                    <a:s r="337">24.0 / </a:s>
                                    <a:s r="339">
                                       <a:s r="338">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="339">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="347">
                              <a:s>(</a:s>
                              <a:s r="347">
                                 <a:s r="348">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="357">
                        <a:s>when </a:s>
                        <a:s r="358">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="359">
                           <a:s r="360">
                              <a:s r="361">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="362">
                                 <a:s>(</a:s>
                                 <a:s r="362">
                                    <a:s r="363">24.0 / </a:s>
                                    <a:s r="365">
                                       <a:s r="364">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="365">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="373">
                              <a:s>(</a:s>
                              <a:s r="373">
                                 <a:s r="374">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="383">
                        <a:s>when </a:s>
                        <a:s r="384">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="385">
                           <a:s r="386">
                              <a:s r="387">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="388">
                                 <a:s>(</a:s>
                                 <a:s r="388">
                                    <a:s r="389">24.0 / </a:s>
                                    <a:s r="391">
                                       <a:s r="390">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="391">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="399">
                              <a:s>(</a:s>
                              <a:s r="399">
                                 <a:s r="400">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s r="409"> /* assuming 365 days in year */
    else null
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="240" locator="36:3-45:5" xsi:type="Case">
            <comparand localId="242" locator="36:8-36:18" path="unit" xsi:type="Property">
               <source localId="241" locator="36:8-36:13" name="period" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="243" locator="37:5-37:51">
               <when localId="244" locator="37:10-37:12" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="245" locator="37:19-37:51" xsi:type="Multiply">
                  <signature localId="256" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="257" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="254" xsi:type="ToDecimal">
                     <signature localId="255" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="246" locator="37:19-37:27" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="247" locator="37:31-37:51" xsi:type="Divide">
                     <signature localId="251" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="252" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="248" locator="37:32-37:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="250" locator="37:39-37:50" path="value" xsi:type="Property">
                        <source localId="249" locator="37:39-37:44" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="258" locator="38:5-38:58">
               <when localId="259" locator="38:10-38:14" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="260" locator="38:21-38:58" xsi:type="Multiply">
                  <signature localId="278" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="279" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="261" locator="38:21-38:53" xsi:type="Multiply">
                     <signature localId="272" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="273" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="270" xsi:type="ToDecimal">
                        <signature localId="271" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="262" locator="38:21-38:29" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="263" locator="38:33-38:53" xsi:type="Divide">
                        <signature localId="267" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="268" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="264" locator="38:34-38:37" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="266" locator="38:41-38:52" path="value" xsi:type="Property">
                           <source localId="265" locator="38:41-38:46" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="276" xsi:type="ToDecimal">
                     <signature localId="277" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="274" locator="38:57-38:58" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="280" locator="39:5-39:61">
               <when localId="281" locator="39:10-39:12" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="282" locator="39:19-39:61" xsi:type="Multiply">
                  <signature localId="307" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="308" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="283" locator="39:19-39:56" xsi:type="Multiply">
                     <signature localId="301" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="302" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="284" locator="39:19-39:51" xsi:type="Multiply">
                        <signature localId="295" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="296" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="293" xsi:type="ToDecimal">
                           <signature localId="294" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="285" locator="39:19-39:27" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="286" locator="39:31-39:51" xsi:type="Divide">
                           <signature localId="290" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="291" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="287" locator="39:32-39:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="289" locator="39:39-39:50" path="value" xsi:type="Property">
                              <source localId="288" locator="39:39-39:44" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="299" xsi:type="ToDecimal">
                        <signature localId="300" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="297" locator="39:55-39:56" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand localId="305" xsi:type="ToDecimal">
                     <signature localId="306" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="303" locator="39:60-39:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="309" locator="40:5-40:56">
               <when localId="310" locator="40:10-40:12" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="311" locator="40:19-40:56" xsi:type="Divide">
                  <signature localId="329" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="330" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="312" locator="40:19-40:51" xsi:type="Multiply">
                     <signature localId="323" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="324" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="321" xsi:type="ToDecimal">
                        <signature localId="322" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="313" locator="40:19-40:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="314" locator="40:31-40:51" xsi:type="Divide">
                        <signature localId="318" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="319" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="315" locator="40:32-40:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="317" locator="40:39-40:50" path="value" xsi:type="Property">
                           <source localId="316" locator="40:39-40:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="327" xsi:type="ToDecimal">
                     <signature localId="328" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="325" locator="40:55-40:56" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="331" locator="41:5-41:63">
               <when localId="332" locator="41:10-41:13" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="333" locator="41:20-41:63" xsi:type="Divide">
                  <signature localId="355" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="356" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="334" locator="41:20-41:52" xsi:type="Multiply">
                     <signature localId="345" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="346" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="343" xsi:type="ToDecimal">
                        <signature localId="344" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="335" locator="41:20-41:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="336" locator="41:32-41:52" xsi:type="Divide">
                        <signature localId="340" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="341" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="337" locator="41:33-41:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="339" locator="41:40-41:51" path="value" xsi:type="Property">
                           <source localId="338" locator="41:40-41:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="353" xsi:type="ToDecimal">
                     <signature localId="354" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="347" locator="41:56-41:63" xsi:type="Multiply">
                        <signature localId="350" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="351" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="348" locator="41:57-41:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="349" locator="41:62" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="357" locator="42:5-42:64">
               <when localId="358" locator="42:10-42:13" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="359" locator="42:20-42:64" xsi:type="Divide">
                  <signature localId="381" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="382" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="360" locator="42:20-42:52" xsi:type="Multiply">
                     <signature localId="371" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="372" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="369" xsi:type="ToDecimal">
                        <signature localId="370" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="361" locator="42:20-42:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="362" locator="42:32-42:52" xsi:type="Divide">
                        <signature localId="366" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="367" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="363" locator="42:33-42:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="365" locator="42:40-42:51" path="value" xsi:type="Property">
                           <source localId="364" locator="42:40-42:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="379" xsi:type="ToDecimal">
                     <signature localId="380" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="373" locator="42:56-42:64" xsi:type="Multiply">
                        <signature localId="376" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="377" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="374" locator="42:57-42:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="375" locator="42:62-42:63" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="383" locator="43:5-43:64">
               <when localId="384" locator="43:10-43:12" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="385" locator="43:19-43:64" xsi:type="Divide">
                  <signature localId="407" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="408" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="386" locator="43:19-43:51" xsi:type="Multiply">
                     <signature localId="397" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="398" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="395" xsi:type="ToDecimal">
                        <signature localId="396" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="387" locator="43:19-43:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="388" locator="43:31-43:51" xsi:type="Divide">
                        <signature localId="392" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="393" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="389" locator="43:32-43:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="391" locator="43:39-43:50" path="value" xsi:type="Property">
                           <source localId="390" locator="43:39-43:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="405" xsi:type="ToDecimal">
                     <signature localId="406" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="399" locator="43:55-43:64" xsi:type="Multiply">
                        <signature localId="402" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="403" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="400" locator="43:56-43:57" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="401" locator="43:61-43:63" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else localId="410" asType="t:Decimal" xsi:type="As">
               <operand localId="409" locator="44:10-44:13" xsi:type="Null"/>
            </else>
         </expression>
         <operand localId="237" name="frequency">
            <operandTypeSpecifier localId="236" locator="35:35-35:41" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="239" name="period">
            <operandTypeSpecifier localId="238" locator="35:51-35:65" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="411" locator="50:1-51:39" name="IsPatch" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="411">
               <a:s>/*
  Returns true if the given dose form is a patch (transdermal system)
*/
define function IsPatch(doseFormCode Code):
  </a:s>
               <a:s r="414">
                  <a:s r="414">
                     <a:s r="420">
                        <a:s>ToInteger(</a:s>
                        <a:s r="416">
                           <a:s r="415">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="416">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s r="422"> = 316987</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="414" locator="51:3-51:39" xsi:type="Equal">
            <signature localId="423" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            <signature localId="424" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
            <operand localId="420" locator="51:3-51:30" xsi:type="ToInteger">
               <signature localId="421" name="t:String" xsi:type="NamedTypeSpecifier"/>
               <operand localId="416" locator="51:13-51:29" path="code" xsi:type="Property">
                  <source localId="415" locator="51:13-51:24" name="doseFormCode" xsi:type="OperandRef"/>
               </operand>
            </operand>
            <operand localId="422" locator="51:34-51:39" valueType="t:Integer" value="316987" xsi:type="Literal"/>
         </expression>
         <operand localId="413" name="doseFormCode">
            <operandTypeSpecifier localId="412" locator="50:38-50:41" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="425" locator="86:1-154:5" name="GetConversionFactor" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="425">
               <a:s>/*
  Returns the conversion factor for the given ingredient

Opioid (strength in mg except where noted)	MME Conversion Factor*
Buprenorphine, transdermal patch (MCG/HR)	12.6
Buprenorphine, tablet or film	30
Buprenorphine, film (MCG)	0.03
Butorphanol	7
Codeine	0.15
Dihydrocodeine	0.25
Fentanyl, buccal/SL tabet or lozenge/troche (MCG)	0.13
Fentanyl, film or oral spray (MCG)	0.18
Fentanyl, nasal spray (MCG)	0.16
Fentanyl, transdermal patch (MCG/HR)	2.4
Hydrocodone	1
Hydromorphone	4
Levomethadyl acetate	8
Levorphanol tartrate	11
Meperidine 	0.1
Methadone	3
  1-20 mg/d 4
  21-40 mg/d 8
  41-60 mg/d 10
  61-80 mg/d 12
Morphine	1
Opium	1 // NOTE: Not present as an ingredient in the RxNorm data
Oxycodone	1.5
Oxymorphone	3
Pentazocine	0.37
Tapentadol	0.4
Tramadol	0.1

*/
define function GetConversionFactor(ingredientCode Code, dailyDose Quantity, doseFormCode Code):
  </a:s>
               <a:s r="432">
                  <a:s r="432">
                     <a:s>case </a:s>
                     <a:s r="438">
                        <a:s>ToInteger(</a:s>
                        <a:s r="434">
                           <a:s r="433">
                              <a:s>ingredientCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="434">
                              <a:s>code</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="440">
                        <a:s r="441">when 161 then 0</a:s>
                     </a:s>
                     <a:s>  /*	Acetaminophen */
    </a:s>
                     <a:s r="443">
                        <a:s r="444">when 1191 then 0</a:s>
                     </a:s>
                     <a:s> /*	Aspirin */
    </a:s>
                     <a:s r="446">
                        <a:s r="447">when 1223 then 0</a:s>
                     </a:s>
                     <a:s> /*	Atropine */
    </a:s>
                     <a:s r="449">
                        <a:s r="450">when 1767 then 0</a:s>
                     </a:s>
                     <a:s> /*	Brompheniramine */
    </a:s>
                     <a:s r="452">
                        <a:s r="453">when 1819 then </a:s>
                        <a:s r="454">
                           <a:s>( /*	Buprenorphine */
      </a:s>
                           <a:s r="454">
                              <a:s>case
        </a:s>
                              <a:s r="455">
                                 <a:s>when </a:s>
                                 <a:s r="456">
                                    <a:s r="462">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="458">
                                          <a:s r="457">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="458">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="464"> = 316987</a:s>
                                 </a:s>
                                 <a:s r="467"> then 12.6</a:s>
                              </a:s>
                              <a:s r="468"> /* Transdermal system */
        else 30 /* Tablet or Film (or Film in MCG) */
      end</a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="472">
                        <a:s r="473">when 1841 then 7</a:s>
                     </a:s>
                     <a:s> /*	Butorphanol */
    </a:s>
                     <a:s r="475">
                        <a:s r="476">when 1886 then 0</a:s>
                     </a:s>
                     <a:s> /*	Caffeine */
    </a:s>
                     <a:s r="478">
                        <a:s r="479">when 2101 then 0</a:s>
                     </a:s>
                     <a:s> /*	Carisoprodol */
    </a:s>
                     <a:s r="481">
                        <a:s r="482">when 2354 then 0</a:s>
                     </a:s>
                     <a:s> /*	chlorcyclizine */
    </a:s>
                     <a:s r="484">
                        <a:s r="485">when 2400 then 0</a:s>
                     </a:s>
                     <a:s> /*	Chlorpheniramine */
    </a:s>
                     <a:s r="487">
                        <a:s r="488">when 2670 then 0.15</a:s>
                     </a:s>
                     <a:s> /*	Codeine */
    </a:s>
                     <a:s r="490">
                        <a:s r="491">when 3423 then 4</a:s>
                     </a:s>
                     <a:s> /*	Hydromorphone */
    </a:s>
                     <a:s r="493">
                        <a:s r="494">when 3498 then 0</a:s>
                     </a:s>
                     <a:s> /*	Diphenhydramine */
    </a:s>
                     <a:s r="496">
                        <a:s r="497">when 4337 then </a:s>
                        <a:s r="498">
                           <a:s>( /*	Fentanyl */
      </a:s>
                           <a:s r="498">
                              <a:s>case
        </a:s>
                              <a:s r="499">
                                 <a:s>when </a:s>
                                 <a:s r="511">
                                    <a:s r="505">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="501">
                                          <a:s r="500">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="501">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> in </a:s>
                                    <a:s r="507">
                                       <a:s r="508">{ 970789, 317007, 316992 }</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="512"> then 0.13</a:s>
                              </a:s>
                              <a:s> /* Buccal Tablet, Sublingual Tablet, Oral Lozenge */
        </a:s>
                              <a:s r="513">
                                 <a:s>when </a:s>
                                 <a:s r="514">
                                    <a:s r="520">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="516">
                                          <a:s r="515">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="516">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="522"> = 346163</a:s>
                                 </a:s>
                                 <a:s r="525"> then 0.18</a:s>
                              </a:s>
                              <a:s> /* Buccal Film */
        </a:s>
                              <a:s r="526">
                                 <a:s>when </a:s>
                                 <a:s r="537">
                                    <a:s r="532">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="528">
                                          <a:s r="527">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="528">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> in </a:s>
                                    <a:s r="534">
                                       <a:s r="535">{ 126542, 346163 }</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="538"> then 0.16</a:s>
                              </a:s>
                              <a:s> /* Nasal Spray, Mucosal Spray */
        </a:s>
                              <a:s r="539">
                                 <a:s>when </a:s>
                                 <a:s r="541">
                                    <a:s>IsPatch(</a:s>
                                    <a:s r="540">
                                       <a:s>doseFormCode</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s r="542"> then 2.4</a:s>
                              </a:s>
                              <a:s> /* Transdermal system */
        else </a:s>
                              <a:s r="550">
                                 <a:s r="543">Message(1000, true, </a:s>
                                 <a:s r="545">
                                    <a:s>'Undefined'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="546">
                                    <a:s>'Error'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="547">
                                    <a:s>'The dose form is unexpected'</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>
      end</a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="554">
                        <a:s r="555">when 5032 then 0</a:s>
                     </a:s>
                     <a:s> /*	Guaifenesin */
    </a:s>
                     <a:s r="557">
                        <a:s r="558">when 5489 then 1</a:s>
                     </a:s>
                     <a:s> /*	Hydrocodone */
    </a:s>
                     <a:s r="560">
                        <a:s r="561">when 5640 then 0</a:s>
                     </a:s>
                     <a:s> /*	Ibuprofen */
    </a:s>
                     <a:s r="563">
                        <a:s r="564">when 6102 then 0</a:s>
                     </a:s>
                     <a:s> /*	Kaolin */
    </a:s>
                     <a:s r="566">
                        <a:s r="567">when 6378 then 11</a:s>
                     </a:s>
                     <a:s> /* Levorphanol (NOTE: Given as Levorphanol tartrate in the CDC conversion table) */
    </a:s>
                     <a:s r="569">
                        <a:s r="570">when 6754 then 0.1</a:s>
                     </a:s>
                     <a:s> /*	Meperidine */
    </a:s>
                     <a:s r="572">
                        <a:s r="573">when 6813 then </a:s>
                        <a:s r="574">
                           <a:s>( /*	Methadone */
      </a:s>
                           <a:s r="574">
                              <a:s>case
        </a:s>
                              <a:s r="575">
                                 <a:s>when </a:s>
                                 <a:s r="580">
                                    <a:s r="577">
                                       <a:s r="576">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="577">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="578"> between 1 and 20</a:s>
                                 </a:s>
                                 <a:s r="593"> then 4</a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="594">
                                 <a:s>when </a:s>
                                 <a:s r="599">
                                    <a:s r="596">
                                       <a:s r="595">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="596">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="597"> between 21 and 40</a:s>
                                 </a:s>
                                 <a:s r="612"> then 8</a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="613">
                                 <a:s>when </a:s>
                                 <a:s r="618">
                                    <a:s r="615">
                                       <a:s r="614">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="615">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="616"> between 41 and 60</a:s>
                                 </a:s>
                                 <a:s r="631"> then 10</a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="632">
                                 <a:s>when </a:s>
                                 <a:s r="633">
                                    <a:s r="635">
                                       <a:s r="634">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="635">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="636"> >= 61</a:s>
                                 </a:s>
                                 <a:s r="642"> then 12</a:s>
                              </a:s>
                              <a:s>
        else </a:s>
                              <a:s r="658">
                                 <a:s r="643">Message(1000, </a:s>
                                 <a:s r="644">
                                    <a:s r="646">
                                       <a:s r="645">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="646">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s r="647"> &lt; 1</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="653">
                                    <a:s>'Undefined'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="654">
                                    <a:s>'Error'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="655">
                                    <a:s>'The dose range is unexpected'</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>
      end</a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="659">
                        <a:s r="660">when 7052 then 1</a:s>
                     </a:s>
                     <a:s> /*	Morphine */
    </a:s>
                     <a:s r="662">
                        <a:s r="663">when 7242 then 0</a:s>
                     </a:s>
                     <a:s> /*	Naloxone */
    </a:s>
                     <a:s r="665">
                        <a:s r="666">when 7243 then 0</a:s>
                     </a:s>
                     <a:s> /*	Naltrexone */
    </a:s>
                     <a:s r="668">
                        <a:s r="669">when 7804 then 1.5</a:s>
                     </a:s>
                     <a:s> /*	Oxycodone */
    </a:s>
                     <a:s r="671">
                        <a:s r="672">when 7814 then 3</a:s>
                     </a:s>
                     <a:s> /*	Oxymorphone */
    </a:s>
                     <a:s r="674">
                        <a:s r="675">when 8001 then 0.37</a:s>
                     </a:s>
                     <a:s> /*	Pentazocine */
    </a:s>
                     <a:s r="677">
                        <a:s r="678">when 8163 then 0</a:s>
                     </a:s>
                     <a:s> /*	Phenylephrine */
    </a:s>
                     <a:s r="680">
                        <a:s r="681">when 8175 then 0</a:s>
                     </a:s>
                     <a:s> /*	Phenylpropanolamine */
    </a:s>
                     <a:s r="683">
                        <a:s r="684">when 8745 then 0</a:s>
                     </a:s>
                     <a:s> /*	Promethazine */
    </a:s>
                     <a:s r="686">
                        <a:s r="687">when 8896 then 0</a:s>
                     </a:s>
                     <a:s> /*	Pseudoephedrine */
    </a:s>
                     <a:s r="689">
                        <a:s r="690">when 9009 then 0</a:s>
                     </a:s>
                     <a:s> /*	Pyrilamine */
    </a:s>
                     <a:s r="692">
                        <a:s r="693">when 10689 then 0.1</a:s>
                     </a:s>
                     <a:s> /*	Tramadol */
    </a:s>
                     <a:s r="695">
                        <a:s r="696">when 10849 then 0</a:s>
                     </a:s>
                     <a:s> /*	Triprolidine */
    </a:s>
                     <a:s r="698">
                        <a:s r="699">when 19759 then 0</a:s>
                     </a:s>
                     <a:s> /*	bromodiphenhydramine */
    </a:s>
                     <a:s r="701">
                        <a:s r="702">when 19860 then 0</a:s>
                     </a:s>
                     <a:s> /*	butalbital */
    </a:s>
                     <a:s r="704">
                        <a:s r="705">when 22696 then 0</a:s>
                     </a:s>
                     <a:s> /*	dexbrompheniramine */
    </a:s>
                     <a:s r="707">
                        <a:s r="708">when 22697 then 0</a:s>
                     </a:s>
                     <a:s> /*	dexchlorpheniramine */
    </a:s>
                     <a:s r="710">
                        <a:s r="711">when 23088 then 0.25</a:s>
                     </a:s>
                     <a:s> /*	dihydrocodeine */
    </a:s>
                     <a:s r="713">
                        <a:s r="714">when 27084 then 0</a:s>
                     </a:s>
                     <a:s> /*	homatropine */
    </a:s>
                     <a:s r="716">
                        <a:s r="717">when 35780 then 0</a:s>
                     </a:s>
                     <a:s> /*	ropivacaine */
    </a:s>
                     <a:s r="719">
                        <a:s r="720">when 237005 then 8</a:s>
                     </a:s>
                     <a:s> /*	Levomethadyl (NOTE: given as Levomethadyl acetate in the CDC conversion table) */
    </a:s>
                     <a:s r="722">
                        <a:s r="723">when 636827 then 0</a:s>
                     </a:s>
                     <a:s> /*	guaiacolsulfonate */
    </a:s>
                     <a:s r="725">
                        <a:s r="726">when 787390 then 0.4</a:s>
                     </a:s>
                     <a:s r="728"> /*	tapentadol */
    else 0
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="432" locator="87:3-154:5" xsi:type="Case">
            <comparand localId="438" locator="87:8-87:37" xsi:type="ToInteger">
               <signature localId="439" name="t:String" xsi:type="NamedTypeSpecifier"/>
               <operand localId="434" locator="87:18-87:36" path="code" xsi:type="Property">
                  <source localId="433" locator="87:18-87:31" name="ingredientCode" xsi:type="OperandRef"/>
               </operand>
            </comparand>
            <caseItem localId="440" locator="88:5-88:19">
               <when localId="441" locator="88:10-88:12" valueType="t:Integer" value="161" xsi:type="Literal"/>
               <then localId="730" xsi:type="ToDecimal">
                  <signature localId="731" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="442" locator="88:19" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="443" locator="89:5-89:20">
               <when localId="444" locator="89:10-89:13" valueType="t:Integer" value="1191" xsi:type="Literal"/>
               <then localId="733" xsi:type="ToDecimal">
                  <signature localId="734" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="445" locator="89:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="446" locator="90:5-90:20">
               <when localId="447" locator="90:10-90:13" valueType="t:Integer" value="1223" xsi:type="Literal"/>
               <then localId="736" xsi:type="ToDecimal">
                  <signature localId="737" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="448" locator="90:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="449" locator="91:5-91:20">
               <when localId="450" locator="91:10-91:13" valueType="t:Integer" value="1767" xsi:type="Literal"/>
               <then localId="739" xsi:type="ToDecimal">
                  <signature localId="740" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="451" locator="91:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="452" locator="92:5-97:5">
               <when localId="453" locator="92:10-92:13" valueType="t:Integer" value="1819" xsi:type="Literal"/>
               <then localId="454" locator="92:20-97:5" xsi:type="Case">
                  <caseItem localId="455" locator="94:9-94:60">
                     <when localId="456" locator="94:14-94:50" xsi:type="Equal">
                        <signature localId="465" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="466" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="462" locator="94:14-94:41" xsi:type="ToInteger">
                           <signature localId="463" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="458" locator="94:24-94:40" path="code" xsi:type="Property">
                              <source localId="457" locator="94:24-94:35" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="464" locator="94:45-94:50" valueType="t:Integer" value="316987" xsi:type="Literal"/>
                     </when>
                     <then localId="467" locator="94:57-94:60" valueType="t:Decimal" value="12.6" xsi:type="Literal"/>
                  </caseItem>
                  <else localId="470" xsi:type="ToDecimal">
                     <signature localId="471" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="468" locator="95:14-95:15" valueType="t:Integer" value="30" xsi:type="Literal"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="472" locator="98:5-98:20">
               <when localId="473" locator="98:10-98:13" valueType="t:Integer" value="1841" xsi:type="Literal"/>
               <then localId="742" xsi:type="ToDecimal">
                  <signature localId="743" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="474" locator="98:20" valueType="t:Integer" value="7" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="475" locator="99:5-99:20">
               <when localId="476" locator="99:10-99:13" valueType="t:Integer" value="1886" xsi:type="Literal"/>
               <then localId="745" xsi:type="ToDecimal">
                  <signature localId="746" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="477" locator="99:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="478" locator="100:5-100:20">
               <when localId="479" locator="100:10-100:13" valueType="t:Integer" value="2101" xsi:type="Literal"/>
               <then localId="748" xsi:type="ToDecimal">
                  <signature localId="749" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="480" locator="100:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="481" locator="101:5-101:20">
               <when localId="482" locator="101:10-101:13" valueType="t:Integer" value="2354" xsi:type="Literal"/>
               <then localId="751" xsi:type="ToDecimal">
                  <signature localId="752" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="483" locator="101:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="484" locator="102:5-102:20">
               <when localId="485" locator="102:10-102:13" valueType="t:Integer" value="2400" xsi:type="Literal"/>
               <then localId="754" xsi:type="ToDecimal">
                  <signature localId="755" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="486" locator="102:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="487" locator="103:5-103:23">
               <when localId="488" locator="103:10-103:13" valueType="t:Integer" value="2670" xsi:type="Literal"/>
               <then localId="489" locator="103:20-103:23" valueType="t:Decimal" value="0.15" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="490" locator="104:5-104:20">
               <when localId="491" locator="104:10-104:13" valueType="t:Integer" value="3423" xsi:type="Literal"/>
               <then localId="757" xsi:type="ToDecimal">
                  <signature localId="758" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="492" locator="104:20" valueType="t:Integer" value="4" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="493" locator="105:5-105:20">
               <when localId="494" locator="105:10-105:13" valueType="t:Integer" value="3498" xsi:type="Literal"/>
               <then localId="760" xsi:type="ToDecimal">
                  <signature localId="761" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="495" locator="105:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="496" locator="106:5-114:5">
               <when localId="497" locator="106:10-106:13" valueType="t:Integer" value="4337" xsi:type="Literal"/>
               <then localId="498" locator="106:20-114:5" xsi:type="Case">
                  <caseItem localId="499" locator="108:9-108:81">
                     <when localId="511" locator="108:14-108:71" xsi:type="In">
                        <operand localId="505" locator="108:14-108:41" xsi:type="ToInteger">
                           <signature localId="506" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="501" locator="108:24-108:40" path="code" xsi:type="Property">
                              <source localId="500" locator="108:24-108:35" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="507" locator="108:46-108:71" xsi:type="List">
                           <element localId="508" locator="108:48-108:53" valueType="t:Integer" value="970789" xsi:type="Literal"/>
                           <element localId="509" locator="108:56-108:61" valueType="t:Integer" value="317007" xsi:type="Literal"/>
                           <element localId="510" locator="108:64-108:69" valueType="t:Integer" value="316992" xsi:type="Literal"/>
                        </operand>
                     </when>
                     <then localId="512" locator="108:78-108:81" valueType="t:Decimal" value="0.13" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="513" locator="109:9-109:60">
                     <when localId="514" locator="109:14-109:50" xsi:type="Equal">
                        <signature localId="523" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="524" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="520" locator="109:14-109:41" xsi:type="ToInteger">
                           <signature localId="521" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="516" locator="109:24-109:40" path="code" xsi:type="Property">
                              <source localId="515" locator="109:24-109:35" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="522" locator="109:45-109:50" valueType="t:Integer" value="346163" xsi:type="Literal"/>
                     </when>
                     <then localId="525" locator="109:57-109:60" valueType="t:Decimal" value="0.18" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="526" locator="110:9-110:73">
                     <when localId="537" locator="110:14-110:63" xsi:type="In">
                        <operand localId="532" locator="110:14-110:41" xsi:type="ToInteger">
                           <signature localId="533" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="528" locator="110:24-110:40" path="code" xsi:type="Property">
                              <source localId="527" locator="110:24-110:35" name="doseFormCode" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="534" locator="110:46-110:63" xsi:type="List">
                           <element localId="535" locator="110:48-110:53" valueType="t:Integer" value="126542" xsi:type="Literal"/>
                           <element localId="536" locator="110:56-110:61" valueType="t:Integer" value="346163" xsi:type="Literal"/>
                        </operand>
                     </when>
                     <then localId="538" locator="110:70-110:73" valueType="t:Decimal" value="0.16" xsi:type="Literal"/>
                  </caseItem>
                  <caseItem localId="539" locator="111:9-111:43">
                     <when localId="541" locator="111:14-111:34" name="IsPatch" xsi:type="FunctionRef">
                        <operand localId="540" locator="111:22-111:33" name="doseFormCode" xsi:type="OperandRef"/>
                     </when>
                     <then localId="542" locator="111:41-111:43" valueType="t:Decimal" value="2.4" xsi:type="Literal"/>
                  </caseItem>
                  <else localId="552" xsi:type="ToDecimal">
                     <signature localId="553" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="550" locator="112:14-112:85" xsi:type="Message">
                        <source localId="543" locator="112:22-112:25" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                        <condition localId="544" locator="112:28-112:31" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                        <code localId="545" locator="112:34-112:44" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                        <severity localId="546" locator="112:47-112:53" valueType="t:String" value="Error" xsi:type="Literal"/>
                        <message localId="547" locator="112:56-112:84" valueType="t:String" value="The dose form is unexpected" xsi:type="Literal"/>
                     </operand>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="554" locator="115:5-115:20">
               <when localId="555" locator="115:10-115:13" valueType="t:Integer" value="5032" xsi:type="Literal"/>
               <then localId="763" xsi:type="ToDecimal">
                  <signature localId="764" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="556" locator="115:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="557" locator="116:5-116:20">
               <when localId="558" locator="116:10-116:13" valueType="t:Integer" value="5489" xsi:type="Literal"/>
               <then localId="766" xsi:type="ToDecimal">
                  <signature localId="767" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="559" locator="116:20" valueType="t:Integer" value="1" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="560" locator="117:5-117:20">
               <when localId="561" locator="117:10-117:13" valueType="t:Integer" value="5640" xsi:type="Literal"/>
               <then localId="769" xsi:type="ToDecimal">
                  <signature localId="770" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="562" locator="117:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="563" locator="118:5-118:20">
               <when localId="564" locator="118:10-118:13" valueType="t:Integer" value="6102" xsi:type="Literal"/>
               <then localId="772" xsi:type="ToDecimal">
                  <signature localId="773" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="565" locator="118:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="566" locator="119:5-119:21">
               <when localId="567" locator="119:10-119:13" valueType="t:Integer" value="6378" xsi:type="Literal"/>
               <then localId="775" xsi:type="ToDecimal">
                  <signature localId="776" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="568" locator="119:20-119:21" valueType="t:Integer" value="11" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="569" locator="120:5-120:22">
               <when localId="570" locator="120:10-120:13" valueType="t:Integer" value="6754" xsi:type="Literal"/>
               <then localId="571" locator="120:20-120:22" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="572" locator="121:5-129:5">
               <when localId="573" locator="121:10-121:13" valueType="t:Integer" value="6813" xsi:type="Literal"/>
               <then localId="778" xsi:type="ToDecimal">
                  <signature localId="779" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="574" locator="121:20-129:5" xsi:type="Case">
                     <caseItem localId="575" locator="123:9-123:52">
                        <when localId="580" locator="123:14-123:45" xsi:type="And">
                           <operand localId="581" xsi:type="GreaterOrEqual">
                              <signature localId="586" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="587" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="577" locator="123:14-123:28" path="value" xsi:type="Property">
                                 <source localId="576" locator="123:14-123:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="584" xsi:type="ToDecimal">
                                 <signature localId="585" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="578" locator="123:38" valueType="t:Integer" value="1" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand localId="582" xsi:type="LessOrEqual">
                              <signature localId="591" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="592" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="577" locator="123:14-123:28" path="value" xsi:type="Property">
                                 <source localId="576" locator="123:14-123:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="589" xsi:type="ToDecimal">
                                 <signature localId="590" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="579" locator="123:44-123:45" valueType="t:Integer" value="20" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="593" locator="123:52" valueType="t:Integer" value="4" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="594" locator="124:9-124:53">
                        <when localId="599" locator="124:14-124:46" xsi:type="And">
                           <operand localId="600" xsi:type="GreaterOrEqual">
                              <signature localId="605" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="606" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="596" locator="124:14-124:28" path="value" xsi:type="Property">
                                 <source localId="595" locator="124:14-124:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="603" xsi:type="ToDecimal">
                                 <signature localId="604" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="597" locator="124:38-124:39" valueType="t:Integer" value="21" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand localId="601" xsi:type="LessOrEqual">
                              <signature localId="610" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="611" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="596" locator="124:14-124:28" path="value" xsi:type="Property">
                                 <source localId="595" locator="124:14-124:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="608" xsi:type="ToDecimal">
                                 <signature localId="609" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="598" locator="124:45-124:46" valueType="t:Integer" value="40" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="612" locator="124:53" valueType="t:Integer" value="8" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="613" locator="125:9-125:54">
                        <when localId="618" locator="125:14-125:46" xsi:type="And">
                           <operand localId="619" xsi:type="GreaterOrEqual">
                              <signature localId="624" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="625" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="615" locator="125:14-125:28" path="value" xsi:type="Property">
                                 <source localId="614" locator="125:14-125:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="622" xsi:type="ToDecimal">
                                 <signature localId="623" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="616" locator="125:38-125:39" valueType="t:Integer" value="41" xsi:type="Literal"/>
                              </operand>
                           </operand>
                           <operand localId="620" xsi:type="LessOrEqual">
                              <signature localId="629" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <signature localId="630" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="615" locator="125:14-125:28" path="value" xsi:type="Property">
                                 <source localId="614" locator="125:14-125:22" name="dailyDose" xsi:type="OperandRef"/>
                              </operand>
                              <operand localId="627" xsi:type="ToDecimal">
                                 <signature localId="628" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="617" locator="125:45-125:46" valueType="t:Integer" value="60" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </when>
                        <then localId="631" locator="125:53-125:54" valueType="t:Integer" value="10" xsi:type="Literal"/>
                     </caseItem>
                     <caseItem localId="632" locator="126:9-126:42">
                        <when localId="633" locator="126:14-126:34" xsi:type="GreaterOrEqual">
                           <signature localId="640" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="641" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="635" locator="126:14-126:28" path="value" xsi:type="Property">
                              <source localId="634" locator="126:14-126:22" name="dailyDose" xsi:type="OperandRef"/>
                           </operand>
                           <operand localId="638" xsi:type="ToDecimal">
                              <signature localId="639" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="636" locator="126:33-126:34" valueType="t:Integer" value="61" xsi:type="Literal"/>
                           </operand>
                        </when>
                        <then localId="642" locator="126:41-126:42" valueType="t:Integer" value="12" xsi:type="Literal"/>
                     </caseItem>
                     <else localId="658" locator="127:14-127:101" xsi:type="Message">
                        <source localId="643" locator="127:22-127:25" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                        <condition localId="644" locator="127:28-127:46" xsi:type="Less">
                           <signature localId="651" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="652" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="646" locator="127:28-127:42" path="value" xsi:type="Property">
                              <source localId="645" locator="127:28-127:36" name="dailyDose" xsi:type="OperandRef"/>
                           </operand>
                           <operand localId="649" xsi:type="ToDecimal">
                              <signature localId="650" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="647" locator="127:46" valueType="t:Integer" value="1" xsi:type="Literal"/>
                           </operand>
                        </condition>
                        <code localId="653" locator="127:49-127:59" valueType="t:String" value="Undefined" xsi:type="Literal"/>
                        <severity localId="654" locator="127:62-127:68" valueType="t:String" value="Error" xsi:type="Literal"/>
                        <message localId="655" locator="127:71-127:100" valueType="t:String" value="The dose range is unexpected" xsi:type="Literal"/>
                     </else>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="659" locator="130:5-130:20">
               <when localId="660" locator="130:10-130:13" valueType="t:Integer" value="7052" xsi:type="Literal"/>
               <then localId="781" xsi:type="ToDecimal">
                  <signature localId="782" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="661" locator="130:20" valueType="t:Integer" value="1" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="662" locator="131:5-131:20">
               <when localId="663" locator="131:10-131:13" valueType="t:Integer" value="7242" xsi:type="Literal"/>
               <then localId="784" xsi:type="ToDecimal">
                  <signature localId="785" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="664" locator="131:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="665" locator="132:5-132:20">
               <when localId="666" locator="132:10-132:13" valueType="t:Integer" value="7243" xsi:type="Literal"/>
               <then localId="787" xsi:type="ToDecimal">
                  <signature localId="788" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="667" locator="132:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="668" locator="133:5-133:22">
               <when localId="669" locator="133:10-133:13" valueType="t:Integer" value="7804" xsi:type="Literal"/>
               <then localId="670" locator="133:20-133:22" valueType="t:Decimal" value="1.5" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="671" locator="134:5-134:20">
               <when localId="672" locator="134:10-134:13" valueType="t:Integer" value="7814" xsi:type="Literal"/>
               <then localId="790" xsi:type="ToDecimal">
                  <signature localId="791" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="673" locator="134:20" valueType="t:Integer" value="3" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="674" locator="135:5-135:23">
               <when localId="675" locator="135:10-135:13" valueType="t:Integer" value="8001" xsi:type="Literal"/>
               <then localId="676" locator="135:20-135:23" valueType="t:Decimal" value="0.37" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="677" locator="136:5-136:20">
               <when localId="678" locator="136:10-136:13" valueType="t:Integer" value="8163" xsi:type="Literal"/>
               <then localId="793" xsi:type="ToDecimal">
                  <signature localId="794" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="679" locator="136:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="680" locator="137:5-137:20">
               <when localId="681" locator="137:10-137:13" valueType="t:Integer" value="8175" xsi:type="Literal"/>
               <then localId="796" xsi:type="ToDecimal">
                  <signature localId="797" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="682" locator="137:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="683" locator="138:5-138:20">
               <when localId="684" locator="138:10-138:13" valueType="t:Integer" value="8745" xsi:type="Literal"/>
               <then localId="799" xsi:type="ToDecimal">
                  <signature localId="800" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="685" locator="138:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="686" locator="139:5-139:20">
               <when localId="687" locator="139:10-139:13" valueType="t:Integer" value="8896" xsi:type="Literal"/>
               <then localId="802" xsi:type="ToDecimal">
                  <signature localId="803" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="688" locator="139:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="689" locator="140:5-140:20">
               <when localId="690" locator="140:10-140:13" valueType="t:Integer" value="9009" xsi:type="Literal"/>
               <then localId="805" xsi:type="ToDecimal">
                  <signature localId="806" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="691" locator="140:20" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="692" locator="141:5-141:23">
               <when localId="693" locator="141:10-141:14" valueType="t:Integer" value="10689" xsi:type="Literal"/>
               <then localId="694" locator="141:21-141:23" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="695" locator="142:5-142:21">
               <when localId="696" locator="142:10-142:14" valueType="t:Integer" value="10849" xsi:type="Literal"/>
               <then localId="808" xsi:type="ToDecimal">
                  <signature localId="809" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="697" locator="142:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="698" locator="143:5-143:21">
               <when localId="699" locator="143:10-143:14" valueType="t:Integer" value="19759" xsi:type="Literal"/>
               <then localId="811" xsi:type="ToDecimal">
                  <signature localId="812" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="700" locator="143:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="701" locator="144:5-144:21">
               <when localId="702" locator="144:10-144:14" valueType="t:Integer" value="19860" xsi:type="Literal"/>
               <then localId="814" xsi:type="ToDecimal">
                  <signature localId="815" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="703" locator="144:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="704" locator="145:5-145:21">
               <when localId="705" locator="145:10-145:14" valueType="t:Integer" value="22696" xsi:type="Literal"/>
               <then localId="817" xsi:type="ToDecimal">
                  <signature localId="818" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="706" locator="145:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="707" locator="146:5-146:21">
               <when localId="708" locator="146:10-146:14" valueType="t:Integer" value="22697" xsi:type="Literal"/>
               <then localId="820" xsi:type="ToDecimal">
                  <signature localId="821" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="709" locator="146:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="710" locator="147:5-147:24">
               <when localId="711" locator="147:10-147:14" valueType="t:Integer" value="23088" xsi:type="Literal"/>
               <then localId="712" locator="147:21-147:24" valueType="t:Decimal" value="0.25" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="713" locator="148:5-148:21">
               <when localId="714" locator="148:10-148:14" valueType="t:Integer" value="27084" xsi:type="Literal"/>
               <then localId="823" xsi:type="ToDecimal">
                  <signature localId="824" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="715" locator="148:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="716" locator="149:5-149:21">
               <when localId="717" locator="149:10-149:14" valueType="t:Integer" value="35780" xsi:type="Literal"/>
               <then localId="826" xsi:type="ToDecimal">
                  <signature localId="827" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="718" locator="149:21" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="719" locator="150:5-150:22">
               <when localId="720" locator="150:10-150:15" valueType="t:Integer" value="237005" xsi:type="Literal"/>
               <then localId="829" xsi:type="ToDecimal">
                  <signature localId="830" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="721" locator="150:22" valueType="t:Integer" value="8" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="722" locator="151:5-151:22">
               <when localId="723" locator="151:10-151:15" valueType="t:Integer" value="636827" xsi:type="Literal"/>
               <then localId="832" xsi:type="ToDecimal">
                  <signature localId="833" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="724" locator="151:22" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </then>
            </caseItem>
            <caseItem localId="725" locator="152:5-152:24">
               <when localId="726" locator="152:10-152:15" valueType="t:Integer" value="787390" xsi:type="Literal"/>
               <then localId="727" locator="152:22-152:24" valueType="t:Decimal" value="0.4" xsi:type="Literal"/>
            </caseItem>
            <else localId="835" xsi:type="ToDecimal">
               <signature localId="836" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
               <operand localId="728" locator="153:10" valueType="t:Integer" value="0" xsi:type="Literal"/>
            </else>
         </expression>
         <operand localId="427" name="ingredientCode">
            <operandTypeSpecifier localId="426" locator="86:52-86:55" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="429" name="dailyDose">
            <operandTypeSpecifier localId="428" locator="86:68-86:75" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="431" name="doseFormCode">
            <operandTypeSpecifier localId="430" locator="86:91-86:94" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="837" locator="156:1-163:12" name="EnsureMicrogramQuantity" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="837">
               <a:s>define function EnsureMicrogramQuantity(strength Quantity):
  </a:s>
               <a:s r="840">
                  <a:s r="840">
                     <a:s>if </a:s>
                     <a:s r="841">
                        <a:s r="842">
                           <a:s r="844">
                              <a:s r="843">
                                 <a:s>strength</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="844">
                                 <a:s>value</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="845"> &lt; 0.1</a:s>
                        </a:s>
                        <a:s> and </a:s>
                        <a:s r="848">
                           <a:s>(</a:s>
                           <a:s r="848">
                              <a:s r="854">
                                 <a:s>PositionOf(</a:s>
                                 <a:s r="849">
                                    <a:s>'mg'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="851">
                                    <a:s r="850">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="851">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="855"> = 0</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="858">
                        <a:s>Quantity {
      </a:s>
                        <a:s>
                           <a:s>value: </a:s>
                           <a:s r="860">
                              <a:s r="862">
                                 <a:s r="861">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="862">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="863"> * 1000</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>unit: </a:s>
                           <a:s r="879">
                              <a:s r="870">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="876">
                                 <a:s>Substring(</a:s>
                                 <a:s r="872">
                                    <a:s r="871">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="872">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="873">, 2)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    }</a:s>
                     </a:s>
                     <a:s>
  else
    </a:s>
                     <a:s r="880">
                        <a:s>strength</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="840" locator="157:3-163:12" xsi:type="If">
            <condition localId="841" locator="157:6-157:67" xsi:type="And">
               <operand localId="842" locator="157:6-157:25" xsi:type="Less">
                  <signature localId="846" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="847" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="844" locator="157:6-157:19" path="value" xsi:type="Property">
                     <source localId="843" locator="157:6-157:13" name="strength" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="845" locator="157:23-157:25" valueType="t:Decimal" value="0.1" xsi:type="Literal"/>
               </operand>
               <operand localId="848" locator="157:31-157:67" xsi:type="Equal">
                  <signature localId="856" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="857" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="854" locator="157:32-157:62" xsi:type="PositionOf">
                     <pattern localId="849" locator="157:43-157:46" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <string localId="851" locator="157:49-157:61" path="unit" xsi:type="Property">
                        <source localId="850" locator="157:49-157:56" name="strength" xsi:type="OperandRef"/>
                     </string>
                  </operand>
                  <operand localId="855" locator="157:66" valueType="t:Integer" value="0" xsi:type="Literal"/>
               </operand>
            </condition>
            <then localId="858" locator="158:5-161:5" classType="t:Quantity" xsi:type="Instance">
               <element name="value">
                  <value localId="860" locator="159:14-159:34" xsi:type="Multiply">
                     <signature localId="867" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="868" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="862" locator="159:14-159:27" path="value" xsi:type="Property">
                        <source localId="861" locator="159:14-159:21" name="strength" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="865" xsi:type="ToDecimal">
                        <signature localId="866" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="863" locator="159:31-159:34" valueType="t:Integer" value="1000" xsi:type="Literal"/>
                     </operand>
                  </value>
               </element>
               <element name="unit">
                  <value localId="879" locator="160:13-160:47" xsi:type="Concatenate">
                     <operand localId="870" locator="160:13-160:17" valueType="t:String" value="mcg" xsi:type="Literal"/>
                     <operand localId="876" locator="160:21-160:47" xsi:type="Substring">
                        <stringToSub localId="872" locator="160:31-160:43" path="unit" xsi:type="Property">
                           <source localId="871" locator="160:31-160:38" name="strength" xsi:type="OperandRef"/>
                        </stringToSub>
                        <startIndex localId="873" locator="160:46" valueType="t:Integer" value="2" xsi:type="Literal"/>
                     </operand>
                  </value>
               </element>
            </then>
            <else localId="880" locator="163:5-163:12" name="strength" xsi:type="OperandRef"/>
         </expression>
         <operand localId="839" name="strength">
            <operandTypeSpecifier localId="838" locator="156:50-156:57" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="881" locator="178:1-188:3" name="GetIngredients" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="881">
               <a:s>/*
  Returns the non-surgical opioid ingredients and their strengths that
  make up the drug identified by the given rxNormCode as a list of tuples:

  List&lt;Tuple {
    rxNormCode Code,
    doseFormCode Code,
    doseFormName String,
    ingredientCode Code,
    ingredientName String,
    strength Quantity
  }>
*/
define function GetIngredients(rxNormCode Code):
  </a:s>
               <a:s r="884">
                  <a:s r="884">
                     <a:s>{
    </a:s>
                     <a:s r="885">
                        <a:s>{
      </a:s>
                        <a:s>
                           <a:s>rxNormCode: </a:s>
                           <a:s r="886">
                              <a:s>rxNormCode</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>doseFormCode: </a:s>
                           <a:s r="887">
                              <a:s r="888">null as </a:s>
                              <a:s r="889">
                                 <a:s>Code</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>doseFormName: </a:s>
                           <a:s r="890">
                              <a:s r="891">null as </a:s>
                              <a:s r="892">
                                 <a:s>String</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>ingredientCode: </a:s>
                           <a:s r="893">
                              <a:s r="894">null as </a:s>
                              <a:s r="895">
                                 <a:s>Code</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>ingredientName: </a:s>
                           <a:s r="896">
                              <a:s r="897">null as </a:s>
                              <a:s r="898">
                                 <a:s>String</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s>
                           <a:s>strength: </a:s>
                           <a:s r="899">
                              <a:s r="900">null as </a:s>
                              <a:s r="901">
                                 <a:s>Quantity</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    }</a:s>
                     </a:s>
                     <a:s>
  }</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="884" locator="179:3-188:3" xsi:type="List">
            <element localId="885" locator="180:5-187:5" xsi:type="Tuple">
               <element name="rxNormCode">
                  <value localId="886" locator="181:19-181:28" name="rxNormCode" xsi:type="OperandRef"/>
               </element>
               <element name="doseFormCode">
                  <value localId="887" locator="182:21-182:32" strict="false" xsi:type="As">
                     <operand localId="888" locator="182:21-182:24" xsi:type="Null"/>
                     <asTypeSpecifier localId="889" locator="182:29-182:32" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </value>
               </element>
               <element name="doseFormName">
                  <value localId="890" locator="183:21-183:34" strict="false" xsi:type="As">
                     <operand localId="891" locator="183:21-183:24" xsi:type="Null"/>
                     <asTypeSpecifier localId="892" locator="183:29-183:34" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  </value>
               </element>
               <element name="ingredientCode">
                  <value localId="893" locator="184:23-184:34" strict="false" xsi:type="As">
                     <operand localId="894" locator="184:23-184:26" xsi:type="Null"/>
                     <asTypeSpecifier localId="895" locator="184:31-184:34" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </value>
               </element>
               <element name="ingredientName">
                  <value localId="896" locator="185:23-185:36" strict="false" xsi:type="As">
                     <operand localId="897" locator="185:23-185:26" xsi:type="Null"/>
                     <asTypeSpecifier localId="898" locator="185:31-185:36" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  </value>
               </element>
               <element name="strength">
                  <value localId="899" locator="186:17-186:32" strict="false" xsi:type="As">
                     <operand localId="900" locator="186:17-186:20" xsi:type="Null"/>
                     <asTypeSpecifier localId="901" locator="186:25-186:32" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </value>
               </element>
            </element>
         </expression>
         <operand localId="883" name="rxNormCode">
            <operandTypeSpecifier localId="882" locator="178:43-178:46" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="902" locator="226:1-247:5" name="GetDailyDose" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="902">
               <a:s>/*
  (
    [MED_SCDC_FOR_DRUG: DRUG_RXCUI in rxNormCode] SD
      where exists ([NON_SURGICAL_OPIOID_TO_INCLUDE: DRUG_RXCUI in SD.DRUG_RXCUI])
      return {
        rxNormCode: rxNormCode,
        component: SingletonFrom([MED_SCDC: SCDC_RXCUI in SD.SCDC_RXCUI]),
        ingredientCode: SingletonFrom([MED_INGREDIENT_FOR_SCDC: SCDC_RXCUI in SD.SCDC_RXCUI]).INGREDIENT_RXCUI,
        doseFormCode: SingletonFrom([MED_DRUG_DOSE_FORM: DRUG_RXCUI in SD.DRUG_RXCUI]).DOSE_FORM_RXCUI // Could potentially look this up only once...
      }
  ) C
    let
      ingredient: SingletonFrom([MED_INGREDIENT: INGREDIENT_RXCUI in C.ingredientCode]),
      doseForm: SingletonFrom([MED_DOSE_FORM: DOSE_FORM_RXCUI in C.doseFormCode])
    where exists (
      [MED_INGREDIENT_TYPE: INGREDIENT_RXCUI in C.ingredientCode] IT
        where IT.INGREDIENT_TYPE = 'NonSurgicalOpioid'
    )
    return {
      rxNormCode: rxNormCode,
      doseFormCode: C.doseFormCode,
      doseFormName: doseForm.DOSE_FORM_NAME,
      ingredientCode: C.ingredientCode,
      ingredientName: ingredient.INGREDIENT_NAME,
      strength:
        EnsureMicrogramQuantity(
          Quantity {
            value: C.component.STRENGTH_VALUE,
            unit: ToUCUM(C.component.STRENGTH_UNIT)
          }
        )
    }
*/

/*
  Calculates daily dose for a specific ingredient based on the ingredient strength, dose form, dose quantity, and daily frequency
*/
define function GetDailyDose(ingredientCode Code, strength Quantity, doseFormCode Code, doseQuantity Quantity, dosesPerDay Decimal):
  </a:s>
               <a:s r="913">
                  <a:s r="913">
                     <a:s>case
	  /* if patch --> daily dose = dose value (e.g, number patches with doseQuantity unit = &quot;patch&quot;) * per-hour strength */
    </a:s>
                     <a:s r="914">
                        <a:s>when </a:s>
                        <a:s r="916">
                           <a:s>IsPatch(</a:s>
                           <a:s r="915">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then
      /* buprenorphine or fentanyl patch */
      </a:s>
                        <a:s r="917">
                           <a:s>if </a:s>
                           <a:s r="928">
                              <a:s r="923">
                                 <a:s>ToInteger(</a:s>
                                 <a:s r="919">
                                    <a:s r="918">
                                       <a:s>ingredientCode</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="919">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> in </a:s>
                              <a:s r="925">
                                 <a:s r="926">{ 1819, 4337 }</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="929">
                              <a:s>Quantity { </a:s>
                              <a:s>
                                 <a:s>value: </a:s>
                                 <a:s r="931">
                                    <a:s r="933">
                                       <a:s r="932">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="933">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="935">
                                       <a:s r="934">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="935">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s>
                                 <a:s>unit: </a:s>
                                 <a:s r="939">
                                    <a:s r="938">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="939">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                           <a:s r="940">
      else
        null</a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if dose unit in actual mass units (mg or mcg -- when it's a single med) --> daily dose = numTimesPerDay * dose */
    </a:s>
                     <a:s r="942">
                        <a:s>when </a:s>
                        <a:s r="948">
                           <a:s r="944">
                              <a:s r="943">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="944">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="945">
                              <a:s>{ </a:s>
                              <a:s r="946">
                                 <a:s>'mg'</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="947">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="952">
                           <a:s>Quantity { </a:s>
                           <a:s>
                              <a:s>value: </a:s>
                              <a:s r="954">
                                 <a:s r="955">
                                    <a:s>dosesPerDay</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="957">
                                    <a:s r="956">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="957">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s>
                              <a:s>unit: </a:s>
                              <a:s r="961">
                                 <a:s r="960">
                                    <a:s>doseQuantity</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="961">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s> }</a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if doseQuantity is in actual volume units (mL) --> daily dose = numTimesPerDay * dose * strength */
    </a:s>
                     <a:s r="962">
                        <a:s>when </a:s>
                        <a:s r="963">
                           <a:s r="964">
                              <a:s r="966">
                                 <a:s r="965">
                                    <a:s>doseQuantity</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="966">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="967">
                                 <a:s>'mL'</a:s>
                              </a:s>
                           </a:s>
                           <a:s> and </a:s>
                           <a:s r="970">
                              <a:s>(</a:s>
                              <a:s r="970">
                                 <a:s r="976">
                                    <a:s>PositionOf(</a:s>
                                    <a:s r="971">
                                       <a:s>'/mL'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="973">
                                       <a:s r="972">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="973">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="977">
                                    <a:s r="983">
                                       <a:s>Length(</a:s>
                                       <a:s r="979">
                                          <a:s r="978">
                                             <a:s>strength</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="979">
                                             <a:s>unit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="985"> - 3</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="990">
                           <a:s>Quantity { </a:s>
                           <a:s>
                              <a:s>value: </a:s>
                              <a:s r="992">
                                 <a:s r="993">
                                    <a:s r="994">
                                       <a:s>dosesPerDay</a:s>
                                    </a:s>
                                    <a:s> * </a:s>
                                    <a:s r="996">
                                       <a:s r="995">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="996">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="1000">
                                    <a:s r="999">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1000">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s>
                              <a:s>unit: </a:s>
                              <a:s r="1014">
                                 <a:s>Substring(</a:s>
                                 <a:s r="1004">
                                    <a:s r="1003">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1004">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="1005">, 0, </a:s>
                                 <a:s r="1011">
                                    <a:s>PositionOf(</a:s>
                                    <a:s r="1006">
                                       <a:s>'/'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="1008">
                                       <a:s r="1007">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="1008">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> }</a:s>
                        </a:s>
                     </a:s>
                     <a:s>

		/* if doseQuantity is not in actual units (e.g., 1 tab, 1 spray -- when it's a combo med with a unit of tablet, or it's mg/actuat) -->  daily dose = numTimesPerDay * dose value * strength value */
    else
      </a:s>
                     <a:s r="1015">
                        <a:s>Quantity { </a:s>
                        <a:s>
                           <a:s>value: </a:s>
                           <a:s r="1017">
                              <a:s r="1018">
                                 <a:s r="1019">
                                    <a:s>dosesPerDay</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="1021">
                                    <a:s r="1020">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1021">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="1025">
                                 <a:s r="1024">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="1025">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s>
                           <a:s>unit: </a:s>
                           <a:s r="1039">
                              <a:s>Substring(</a:s>
                              <a:s r="1029">
                                 <a:s r="1028">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="1029">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="1030">, 0, </a:s>
                              <a:s r="1036">
                                 <a:s>PositionOf(</a:s>
                                 <a:s r="1031">
                                    <a:s>'/'</a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="1033">
                                    <a:s r="1032">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1033">
                                       <a:s>unit</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s> }</a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="913" locator="227:3-247:5" xsi:type="Case">
            <caseItem localId="914" locator="229:5-234:12">
               <when localId="916" locator="229:10-229:30" name="IsPatch" xsi:type="FunctionRef">
                  <operand localId="915" locator="229:18-229:29" name="doseFormCode" xsi:type="OperandRef"/>
               </when>
               <then localId="917" locator="231:7-234:12" xsi:type="If">
                  <condition localId="928" locator="231:10-231:57" xsi:type="In">
                     <operand localId="923" locator="231:10-231:39" xsi:type="ToInteger">
                        <signature localId="924" name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="919" locator="231:20-231:38" path="code" xsi:type="Property">
                           <source localId="918" locator="231:20-231:33" name="ingredientCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="925" locator="231:44-231:57" xsi:type="List">
                        <element localId="926" locator="231:46-231:49" valueType="t:Integer" value="1819" xsi:type="Literal"/>
                        <element localId="927" locator="231:52-231:55" valueType="t:Integer" value="4337" xsi:type="Literal"/>
                     </operand>
                  </condition>
                  <then localId="929" locator="232:9-232:84" classType="t:Quantity" xsi:type="Instance">
                     <element name="value">
                        <value localId="931" locator="232:27-232:61" xsi:type="Multiply">
                           <signature localId="936" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="937" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="933" locator="232:27-232:44" path="value" xsi:type="Property">
                              <source localId="932" locator="232:27-232:38" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                           <operand localId="935" locator="232:48-232:61" path="value" xsi:type="Property">
                              <source localId="934" locator="232:48-232:55" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </value>
                     </element>
                     <element name="unit">
                        <value localId="939" locator="232:70-232:82" path="unit" xsi:type="Property">
                           <source localId="938" locator="232:70-232:77" name="strength" xsi:type="OperandRef"/>
                        </value>
                     </element>
                  </then>
                  <else localId="941" asType="t:Quantity" xsi:type="As">
                     <operand localId="940" locator="234:9-234:12" xsi:type="Null"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="942" locator="237:5-238:83">
               <when localId="948" locator="237:10-237:45" xsi:type="In">
                  <signature localId="949" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="950" xsi:type="ListTypeSpecifier">
                     <elementType localId="951" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="944" locator="237:10-237:26" path="unit" xsi:type="Property">
                     <source localId="943" locator="237:10-237:21" name="doseQuantity" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="945" locator="237:31-237:45" xsi:type="List">
                     <element localId="946" locator="237:33-237:36" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <element localId="947" locator="237:39-237:43" valueType="t:String" value="mcg" xsi:type="Literal"/>
                  </operand>
               </when>
               <then localId="952" locator="238:7-238:83" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value localId="954" locator="238:25-238:56" xsi:type="Multiply">
                        <signature localId="958" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="959" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="955" locator="238:25-238:35" name="dosesPerDay" xsi:type="OperandRef"/>
                        <operand localId="957" locator="238:39-238:56" path="value" xsi:type="Property">
                           <source localId="956" locator="238:39-238:50" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="961" locator="238:65-238:81" path="unit" xsi:type="Property">
                        <source localId="960" locator="238:65-238:76" name="doseQuantity" xsi:type="OperandRef"/>
                     </value>
                  </element>
               </then>
            </caseItem>
            <caseItem localId="962" locator="241:5-242:142">
               <when localId="963" locator="241:10-241:100" xsi:type="And">
                  <operand localId="964" locator="241:10-241:33" xsi:type="Equal">
                     <signature localId="968" name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="969" name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="966" locator="241:10-241:26" path="unit" xsi:type="Property">
                        <source localId="965" locator="241:10-241:21" name="doseQuantity" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="967" locator="241:30-241:33" valueType="t:String" value="mL" xsi:type="Literal"/>
                  </operand>
                  <operand localId="970" locator="241:39-241:100" xsi:type="Equal">
                     <signature localId="988" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="989" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="976" locator="241:40-241:71" xsi:type="PositionOf">
                        <pattern localId="971" locator="241:51-241:55" valueType="t:String" value="/mL" xsi:type="Literal"/>
                        <string localId="973" locator="241:58-241:70" path="unit" xsi:type="Property">
                           <source localId="972" locator="241:58-241:65" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </operand>
                     <operand localId="977" locator="241:75-241:99" xsi:type="Subtract">
                        <signature localId="986" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="987" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="983" locator="241:75-241:95" xsi:type="Length">
                           <signature localId="984" name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="979" locator="241:82-241:94" path="unit" xsi:type="Property">
                              <source localId="978" locator="241:82-241:89" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="985" locator="241:99" valueType="t:Integer" value="3" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </when>
               <then localId="990" locator="242:7-242:142" classType="t:Quantity" xsi:type="Instance">
                  <element name="value">
                     <value localId="992" locator="242:25-242:73" xsi:type="Multiply">
                        <signature localId="1001" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="1002" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="993" locator="242:25-242:56" xsi:type="Multiply">
                           <signature localId="997" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <signature localId="998" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="994" locator="242:25-242:35" name="dosesPerDay" xsi:type="OperandRef"/>
                           <operand localId="996" locator="242:39-242:56" path="value" xsi:type="Property">
                              <source localId="995" locator="242:39-242:50" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="1000" locator="242:60-242:73" path="value" xsi:type="Property">
                           <source localId="999" locator="242:60-242:67" name="strength" xsi:type="OperandRef"/>
                        </operand>
                     </value>
                  </element>
                  <element name="unit">
                     <value localId="1014" locator="242:82-242:140" xsi:type="Substring">
                        <stringToSub localId="1004" locator="242:92-242:104" path="unit" xsi:type="Property">
                           <source localId="1003" locator="242:92-242:99" name="strength" xsi:type="OperandRef"/>
                        </stringToSub>
                        <startIndex localId="1005" locator="242:107" valueType="t:Integer" value="0" xsi:type="Literal"/>
                        <length localId="1011" locator="242:110-242:139" xsi:type="PositionOf">
                           <pattern localId="1006" locator="242:121-242:123" valueType="t:String" value="/" xsi:type="Literal"/>
                           <string localId="1008" locator="242:126-242:138" path="unit" xsi:type="Property">
                              <source localId="1007" locator="242:126-242:133" name="strength" xsi:type="OperandRef"/>
                           </string>
                        </length>
                     </value>
                  </element>
               </then>
            </caseItem>
            <else localId="1015" locator="246:7-246:142" classType="t:Quantity" xsi:type="Instance">
               <element name="value">
                  <value localId="1017" locator="246:25-246:73" xsi:type="Multiply">
                     <signature localId="1026" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="1027" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="1018" locator="246:25-246:56" xsi:type="Multiply">
                        <signature localId="1022" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <signature localId="1023" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="1019" locator="246:25-246:35" name="dosesPerDay" xsi:type="OperandRef"/>
                        <operand localId="1021" locator="246:39-246:56" path="value" xsi:type="Property">
                           <source localId="1020" locator="246:39-246:50" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="1025" locator="246:60-246:73" path="value" xsi:type="Property">
                        <source localId="1024" locator="246:60-246:67" name="strength" xsi:type="OperandRef"/>
                     </operand>
                  </value>
               </element>
               <element name="unit">
                  <value localId="1039" locator="246:82-246:140" xsi:type="Substring">
                     <stringToSub localId="1029" locator="246:92-246:104" path="unit" xsi:type="Property">
                        <source localId="1028" locator="246:92-246:99" name="strength" xsi:type="OperandRef"/>
                     </stringToSub>
                     <startIndex localId="1030" locator="246:107" valueType="t:Integer" value="0" xsi:type="Literal"/>
                     <length localId="1036" locator="246:110-246:139" xsi:type="PositionOf">
                        <pattern localId="1031" locator="246:121-246:123" valueType="t:String" value="/" xsi:type="Literal"/>
                        <string localId="1033" locator="246:126-246:138" path="unit" xsi:type="Property">
                           <source localId="1032" locator="246:126-246:133" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </length>
                  </value>
               </element>
            </else>
         </expression>
         <operand localId="904" name="ingredientCode">
            <operandTypeSpecifier localId="903" locator="226:45-226:48" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="906" name="strength">
            <operandTypeSpecifier localId="905" locator="226:60-226:67" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="908" name="doseFormCode">
            <operandTypeSpecifier localId="907" locator="226:83-226:86" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="910" name="doseQuantity">
            <operandTypeSpecifier localId="909" locator="226:102-226:109" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="912" name="dosesPerDay">
            <operandTypeSpecifier localId="911" locator="226:124-226:130" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="1040" locator="249:1-250:20" name="GetMedicationName" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="1040">
               <a:s>define function GetMedicationName(rxNormCode Code):
  </a:s>
               <a:s r="1044">
                  <a:s r="1044">
                     <a:s r="1043">
                        <a:s>rxNormCode</a:s>
                     </a:s>
                     <a:s>.</a:s>
                     <a:s r="1044">
                        <a:s>display</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1044" locator="250:3-250:20" path="display" xsi:type="Property">
            <source localId="1043" locator="250:3-250:12" name="rxNormCode" xsi:type="OperandRef"/>
         </expression>
         <operand localId="1042" name="rxNormCode">
            <operandTypeSpecifier localId="1041" locator="249:46-249:49" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="1045" locator="258:1-275:5" name="GetDailyDoseDescription" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="1045">
               <a:s>/*
  SingletonFrom([MED_DRUG: DRUG_RXCUI in rxNormCode]).DRUG_NAME
  */

/*
  Builds a description for the daily dose for an ingredient
*/
define function GetDailyDoseDescription(ingredientCode Code, ingredientName String, strength Quantity, doseFormCode Code, doseFormName String, doseQuantity Quantity, dosesPerDay Decimal, dailyDose Quantity):
  </a:s>
               <a:s r="1062">
                  <a:s r="1062">
                     <a:s>case
    /* if patch */
    </a:s>
                     <a:s r="1063">
                        <a:s>when </a:s>
                        <a:s r="1065">
                           <a:s>IsPatch(</a:s>
                           <a:s r="1064">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s> then
      /* buprenorphine or fentanyl patch */
      </a:s>
                        <a:s r="1066">
                           <a:s>if </a:s>
                           <a:s r="1077">
                              <a:s r="1072">
                                 <a:s>ToInteger(</a:s>
                                 <a:s r="1068">
                                    <a:s r="1067">
                                       <a:s>ingredientCode</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1068">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> in </a:s>
                              <a:s r="1074">
                                 <a:s r="1075">{ 1819, 4337 }</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="1127">
                              <a:s r="1118">
                                 <a:s r="1114">
                                    <a:s r="1105">
                                       <a:s r="1101">
                                          <a:s r="1091">
                                             <a:s r="1087">
                                                <a:s>ingredientName</a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="1088">
                                                <a:s>' patch: '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="1097">
                                             <a:s>ToString(</a:s>
                                             <a:s r="1093">
                                                <a:s r="1092">
                                                   <a:s>doseQuantity</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="1093">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="1102">
                                          <a:s>' * '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="1110">
                                       <a:s>ToString(</a:s>
                                       <a:s r="1106">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="1115">
                                    <a:s>' = '</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="1123">
                                 <a:s>ToString(</a:s>
                                 <a:s r="1119">
                                    <a:s>dailyDose</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="1128">
      else
        null</a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if dose unit in actual mass units (mg or mcg -- when it's a single med) */
    </a:s>
                     <a:s r="1130">
                        <a:s>when </a:s>
                        <a:s r="1136">
                           <a:s r="1132">
                              <a:s r="1131">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="1132">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="1133">
                              <a:s>{ </a:s>
                              <a:s r="1134">
                                 <a:s>'mg'</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="1135">
                                 <a:s>'mcg'</a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="1195">
                           <a:s r="1186">
                              <a:s r="1182">
                                 <a:s r="1173">
                                    <a:s r="1169">
                                       <a:s r="1160">
                                          <a:s r="1156">
                                             <a:s r="1152">
                                                <a:s r="1148">
                                                   <a:s>ingredientName</a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="1149">
                                                   <a:s>' '</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="1153">
                                                <a:s>doseFormName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="1157">
                                             <a:s>': '</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="1165">
                                          <a:s>ToString(</a:s>
                                          <a:s r="1161">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="1170">
                                       <a:s>'/d * '</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="1178">
                                    <a:s>ToString(</a:s>
                                    <a:s r="1174">
                                       <a:s>doseQuantity</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="1183">
                                 <a:s>' = '</a:s>
                              </a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="1191">
                              <a:s>ToString(</a:s>
                              <a:s r="1187">
                                 <a:s>dailyDose</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if doseQuantity in actual volume units (mL) or not in actual units (e.g. 1 tab, 1 spray) */
    else
      </a:s>
                     <a:s r="1266">
                        <a:s r="1257">
                           <a:s r="1253">
                              <a:s r="1244">
                                 <a:s r="1240">
                                    <a:s r="1231">
                                       <a:s r="1227">
                                          <a:s r="1218">
                                             <a:s r="1214">
                                                <a:s r="1210">
                                                   <a:s r="1206">
                                                      <a:s>ingredientName</a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="1207">
                                                      <a:s>' '</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="1211">
                                                   <a:s>doseFormName</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="1215">
                                                <a:s>': '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="1223">
                                             <a:s>ToString(</a:s>
                                             <a:s r="1219">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="1228">
                                          <a:s>'/d * '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="1236">
                                       <a:s>ToString(</a:s>
                                       <a:s r="1232">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> + </a:s>
                                 <a:s r="1241">
                                    <a:s>' * '</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> + </a:s>
                              <a:s r="1249">
                                 <a:s>ToString(</a:s>
                                 <a:s r="1245">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> + </a:s>
                           <a:s r="1254">
                              <a:s>' = '</a:s>
                           </a:s>
                        </a:s>
                        <a:s> + </a:s>
                        <a:s r="1262">
                           <a:s>ToString(</a:s>
                           <a:s r="1258">
                              <a:s>dailyDose</a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1062" locator="259:3-275:5" xsi:type="Case">
            <caseItem localId="1063" locator="261:5-266:12">
               <when localId="1065" locator="261:10-261:30" name="IsPatch" xsi:type="FunctionRef">
                  <operand localId="1064" locator="261:18-261:29" name="doseFormCode" xsi:type="OperandRef"/>
               </when>
               <then localId="1066" locator="263:7-266:12" xsi:type="If">
                  <condition localId="1077" locator="263:10-263:57" xsi:type="In">
                     <signature localId="1078" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <signature localId="1079" xsi:type="ListTypeSpecifier">
                        <elementType localId="1080" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="1072" locator="263:10-263:39" xsi:type="ToInteger">
                        <signature localId="1073" name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="1068" locator="263:20-263:38" path="code" xsi:type="Property">
                           <source localId="1067" locator="263:20-263:33" name="ingredientCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="1074" locator="263:44-263:57" xsi:type="List">
                        <element localId="1075" locator="263:46-263:49" valueType="t:Integer" value="1819" xsi:type="Literal"/>
                        <element localId="1076" locator="263:52-263:55" valueType="t:Integer" value="4337" xsi:type="Literal"/>
                     </operand>
                  </condition>
                  <then localId="1127" locator="264:9-264:125" xsi:type="Concatenate">
                     <operand localId="1118" locator="264:9-264:103" xsi:type="Concatenate">
                        <operand localId="1114" locator="264:9-264:95" xsi:type="Concatenate">
                           <operand localId="1105" locator="264:9-264:74" xsi:type="Concatenate">
                              <operand localId="1101" locator="264:9-264:66" xsi:type="Concatenate">
                                 <operand localId="1091" locator="264:9-264:35" xsi:type="Concatenate">
                                    <operand localId="1087" locator="264:9-264:22" name="ingredientName" xsi:type="OperandRef"/>
                                    <operand localId="1088" locator="264:26-264:35" valueType="t:String" value=" patch: " xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="1097" locator="264:39-264:66" xsi:type="ToString">
                                    <signature localId="1098" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="1093" locator="264:48-264:65" path="value" xsi:type="Property">
                                       <source localId="1092" locator="264:48-264:59" name="doseQuantity" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="1102" locator="264:70-264:74" valueType="t:String" value=" * " xsi:type="Literal"/>
                           </operand>
                           <operand localId="1110" locator="264:78-264:95" xsi:type="ToString">
                              <signature localId="1111" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="1106" locator="264:87-264:94" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="1115" locator="264:99-264:103" valueType="t:String" value=" = " xsi:type="Literal"/>
                     </operand>
                     <operand localId="1123" locator="264:107-264:125" xsi:type="ToString">
                        <signature localId="1124" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="1119" locator="264:116-264:124" name="dailyDose" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else localId="1129" asType="t:String" xsi:type="As">
                     <operand localId="1128" locator="266:9-266:12" xsi:type="Null"/>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="1130" locator="269:5-270:137">
               <when localId="1136" locator="269:10-269:45" xsi:type="In">
                  <signature localId="1137" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature localId="1138" xsi:type="ListTypeSpecifier">
                     <elementType localId="1139" name="t:String" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="1132" locator="269:10-269:26" path="unit" xsi:type="Property">
                     <source localId="1131" locator="269:10-269:21" name="doseQuantity" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="1133" locator="269:31-269:45" xsi:type="List">
                     <element localId="1134" locator="269:33-269:36" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <element localId="1135" locator="269:39-269:43" valueType="t:String" value="mcg" xsi:type="Literal"/>
                  </operand>
               </when>
               <then localId="1195" locator="270:7-270:137" xsi:type="Concatenate">
                  <operand localId="1186" locator="270:7-270:115" xsi:type="Concatenate">
                     <operand localId="1182" locator="270:7-270:107" xsi:type="Concatenate">
                        <operand localId="1173" locator="270:7-270:82" xsi:type="Concatenate">
                           <operand localId="1169" locator="270:7-270:72" xsi:type="Concatenate">
                              <operand localId="1160" locator="270:7-270:48" xsi:type="Concatenate">
                                 <operand localId="1156" locator="270:7-270:41" xsi:type="Concatenate">
                                    <operand localId="1152" locator="270:7-270:26" xsi:type="Concatenate">
                                       <operand localId="1148" locator="270:7-270:20" name="ingredientName" xsi:type="OperandRef"/>
                                       <operand localId="1149" locator="270:24-270:26" valueType="t:String" value=" " xsi:type="Literal"/>
                                    </operand>
                                    <operand localId="1153" locator="270:30-270:41" name="doseFormName" xsi:type="OperandRef"/>
                                 </operand>
                                 <operand localId="1157" locator="270:45-270:48" valueType="t:String" value=": " xsi:type="Literal"/>
                              </operand>
                              <operand localId="1165" locator="270:52-270:72" xsi:type="ToString">
                                 <signature localId="1166" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="1161" locator="270:61-270:71" name="dosesPerDay" xsi:type="OperandRef"/>
                              </operand>
                           </operand>
                           <operand localId="1170" locator="270:76-270:82" valueType="t:String" value="/d * " xsi:type="Literal"/>
                        </operand>
                        <operand localId="1178" locator="270:86-270:107" xsi:type="ToString">
                           <signature localId="1179" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="1174" locator="270:95-270:106" name="doseQuantity" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="1183" locator="270:111-270:115" valueType="t:String" value=" = " xsi:type="Literal"/>
                  </operand>
                  <operand localId="1191" locator="270:119-270:137" xsi:type="ToString">
                     <signature localId="1192" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="1187" locator="270:128-270:136" name="dailyDose" xsi:type="OperandRef"/>
                  </operand>
               </then>
            </caseItem>
            <else localId="1266" locator="274:7-274:166" xsi:type="Concatenate">
               <operand localId="1257" locator="274:7-274:144" xsi:type="Concatenate">
                  <operand localId="1253" locator="274:7-274:136" xsi:type="Concatenate">
                     <operand localId="1244" locator="274:7-274:115" xsi:type="Concatenate">
                        <operand localId="1240" locator="274:7-274:107" xsi:type="Concatenate">
                           <operand localId="1231" locator="274:7-274:82" xsi:type="Concatenate">
                              <operand localId="1227" locator="274:7-274:72" xsi:type="Concatenate">
                                 <operand localId="1218" locator="274:7-274:48" xsi:type="Concatenate">
                                    <operand localId="1214" locator="274:7-274:41" xsi:type="Concatenate">
                                       <operand localId="1210" locator="274:7-274:26" xsi:type="Concatenate">
                                          <operand localId="1206" locator="274:7-274:20" name="ingredientName" xsi:type="OperandRef"/>
                                          <operand localId="1207" locator="274:24-274:26" valueType="t:String" value=" " xsi:type="Literal"/>
                                       </operand>
                                       <operand localId="1211" locator="274:30-274:41" name="doseFormName" xsi:type="OperandRef"/>
                                    </operand>
                                    <operand localId="1215" locator="274:45-274:48" valueType="t:String" value=": " xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="1223" locator="274:52-274:72" xsi:type="ToString">
                                    <signature localId="1224" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="1219" locator="274:61-274:71" name="dosesPerDay" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                              <operand localId="1228" locator="274:76-274:82" valueType="t:String" value="/d * " xsi:type="Literal"/>
                           </operand>
                           <operand localId="1236" locator="274:86-274:107" xsi:type="ToString">
                              <signature localId="1237" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="1232" locator="274:95-274:106" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="1241" locator="274:111-274:115" valueType="t:String" value=" * " xsi:type="Literal"/>
                     </operand>
                     <operand localId="1249" locator="274:119-274:136" xsi:type="ToString">
                        <signature localId="1250" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="1245" locator="274:128-274:135" name="strength" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand localId="1254" locator="274:140-274:144" valueType="t:String" value=" = " xsi:type="Literal"/>
               </operand>
               <operand localId="1262" locator="274:148-274:166" xsi:type="ToString">
                  <signature localId="1263" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="1258" locator="274:157-274:165" name="dailyDose" xsi:type="OperandRef"/>
               </operand>
            </else>
         </expression>
         <operand localId="1047" name="ingredientCode">
            <operandTypeSpecifier localId="1046" locator="258:56-258:59" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1049" name="ingredientName">
            <operandTypeSpecifier localId="1048" locator="258:77-258:82" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1051" name="strength">
            <operandTypeSpecifier localId="1050" locator="258:94-258:101" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1053" name="doseFormCode">
            <operandTypeSpecifier localId="1052" locator="258:117-258:120" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1055" name="doseFormName">
            <operandTypeSpecifier localId="1054" locator="258:136-258:141" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1057" name="doseQuantity">
            <operandTypeSpecifier localId="1056" locator="258:157-258:164" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1059" name="dosesPerDay">
            <operandTypeSpecifier localId="1058" locator="258:179-258:185" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand localId="1061" name="dailyDose">
            <operandTypeSpecifier localId="1060" locator="258:198-258:205" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="1267" locator="295:1-321:3" name="CalculateMMEs" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="1267">
               <a:s>/*
  Calculates MMEs for the given input prescription information and returns it
  as a list of tuples:

  List&lt;Tuple {
    rxNormCode Code,
    doseFormCode Code,
    doseQuantity Quantity,
    dosesPerDay Decimal,
    ingredientCode Code,
    ingredientName String,
    strength Quantity,
    dailyDose Quantity,
    dailyDoseDescription String,
    conversionFactor Decimal,
    mme Quantity
  }>
*/
define function CalculateMMEs(medications List&lt;Tuple { rxNormCode Code, doseQuantity Quantity, dosesPerDay Decimal }>):
  </a:s>
               <a:s r="1359">
                  <a:s r="1359">
                     <a:s>Flatten(
    </a:s>
                     <a:s r="1356">
                        <a:s>
                           <a:s r="1277">
                              <a:s r="1278">
                                 <a:s>
                                    <a:s>medications</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> M</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s>
                           <a:s>let </a:s>
                           <a:s r="1279">
                              <a:s>Ingredients: </a:s>
                              <a:s r="1282">
                                 <a:s>GetIngredients(</a:s>
                                 <a:s r="1281">
                                    <a:s r="1280">
                                       <a:s>M</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="1281">
                                       <a:s>rxNormCode</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="1283">
                           <a:s>return
        </a:s>
                           <a:s r="1355">
                              <a:s>
                                 <a:s r="1284">
                                    <a:s r="1285">
                                       <a:s>
                                          <a:s>Ingredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> I</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s>
                                 <a:s>let
            </a:s>
                                 <a:s r="1286">
                                    <a:s>adjustedDoseQuantity: </a:s>
                                    <a:s r="1289">
                                       <a:s>EnsureMicrogramQuantity(</a:s>
                                       <a:s r="1288">
                                          <a:s r="1287">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1288">
                                             <a:s>doseQuantity</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
            </a:s>
                                 <a:s r="1290">
                                    <a:s>dailyDose: </a:s>
                                    <a:s r="1300">
                                       <a:s>GetDailyDose(</a:s>
                                       <a:s r="1292">
                                          <a:s r="1291">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1292">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1294">
                                          <a:s r="1293">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1294">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1296">
                                          <a:s r="1295">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1296">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1297">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1299">
                                          <a:s r="1298">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1299">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
            </a:s>
                                 <a:s r="1301">
                                    <a:s>factor: </a:s>
                                    <a:s r="1307">
                                       <a:s>GetConversionFactor(</a:s>
                                       <a:s r="1303">
                                          <a:s r="1302">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1303">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1304">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="1306">
                                          <a:s r="1305">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1306">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s r="1308">
                                 <a:s>return </a:s>
                                 <a:s r="1309">
                                    <a:s>{
            </a:s>
                                    <a:s>
                                       <a:s>rxNormCode: </a:s>
                                       <a:s r="1311">
                                          <a:s r="1310">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1311">
                                             <a:s>rxNormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>doseFormCode: </a:s>
                                       <a:s r="1313">
                                          <a:s r="1312">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1313">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>doseQuantity: </a:s>
                                       <a:s r="1314">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dosesPerDay: </a:s>
                                       <a:s r="1316">
                                          <a:s r="1315">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1316">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>ingredientCode: </a:s>
                                       <a:s r="1318">
                                          <a:s r="1317">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1318">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>ingredientName: </a:s>
                                       <a:s r="1320">
                                          <a:s r="1319">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1320">
                                             <a:s>ingredientName</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>strength: </a:s>
                                       <a:s r="1322">
                                          <a:s r="1321">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="1322">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dailyDose: </a:s>
                                       <a:s r="1323">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dailyDoseDescription: </a:s>
                                       <a:s r="1338">
                                          <a:s>GetDailyDoseDescription(</a:s>
                                          <a:s r="1325">
                                             <a:s r="1324">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1325">
                                                <a:s>ingredientCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1327">
                                             <a:s r="1326">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1327">
                                                <a:s>ingredientName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1329">
                                             <a:s r="1328">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1329">
                                                <a:s>strength</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1331">
                                             <a:s r="1330">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1331">
                                                <a:s>doseFormCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1333">
                                             <a:s r="1332">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1333">
                                                <a:s>doseFormName</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1334">
                                             <a:s>adjustedDoseQuantity</a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1336">
                                             <a:s r="1335">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="1336">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="1337">
                                             <a:s>dailyDose</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>conversionFactor: </a:s>
                                       <a:s r="1339">
                                          <a:s>factor</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>mme: </a:s>
                                       <a:s r="1340">
                                          <a:s>Quantity {
              </a:s>
                                          <a:s>
                                             <a:s>value: </a:s>
                                             <a:s r="1342">
                                                <a:s r="1344">
                                                   <a:s r="1343">
                                                      <a:s>dailyDose</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="1344">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="1345">
                                                   <a:s>factor</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>,
              </a:s>
                                          <a:s>
                                             <a:s>unit: </a:s>
                                             <a:s r="1354">
                                                <a:s r="1350">
                                                   <a:s r="1349">
                                                      <a:s>dailyDose</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="1350">
                                                      <a:s>unit</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="1351">
                                                   <a:s>'/d'</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>
            }</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
          }</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="1359" locator="296:3-321:3" xsi:type="Flatten">
            <operand localId="1356" locator="297:5-320:11" xsi:type="Query">
               <source localId="1277" locator="297:5-297:17" alias="M">
                  <expression localId="1278" locator="297:5-297:15" name="medications" xsi:type="OperandRef"/>
               </source>
               <let localId="1279" locator="298:11-298:51" identifier="Ingredients">
                  <expression localId="1282" locator="298:24-298:51" name="GetIngredients" xsi:type="FunctionRef">
                     <operand localId="1281" locator="298:39-298:50" path="rxNormCode" scope="M" xsi:type="Property"/>
                  </expression>
               </let>
               <return localId="1283" locator="299:7-320:11">
                  <expression localId="1355" locator="300:9-320:11" xsi:type="Query">
                     <source localId="1284" locator="300:9-300:21" alias="I">
                        <expression localId="1285" locator="300:9-300:19" name="Ingredients" xsi:type="QueryLetRef"/>
                     </source>
                     <let localId="1286" locator="302:13-302:73" identifier="adjustedDoseQuantity">
                        <expression localId="1289" locator="302:35-302:73" name="EnsureMicrogramQuantity" xsi:type="FunctionRef">
                           <operand localId="1288" locator="302:59-302:72" path="doseQuantity" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <let localId="1290" locator="303:13-303:118" identifier="dailyDose">
                        <expression localId="1300" locator="303:24-303:118" name="GetDailyDose" xsi:type="FunctionRef">
                           <operand localId="1292" locator="303:37-303:52" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="1294" locator="303:55-303:64" path="strength" scope="I" xsi:type="Property"/>
                           <operand localId="1296" locator="303:67-303:80" path="doseFormCode" scope="I" xsi:type="Property"/>
                           <operand localId="1297" locator="303:83-303:102" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           <operand localId="1299" locator="303:105-303:117" path="dosesPerDay" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <let localId="1301" locator="304:13-304:84" identifier="factor">
                        <expression localId="1307" locator="304:21-304:84" name="GetConversionFactor" xsi:type="FunctionRef">
                           <operand localId="1303" locator="304:41-304:56" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="1304" locator="304:59-304:67" name="dailyDose" xsi:type="QueryLetRef"/>
                           <operand localId="1306" locator="304:70-304:83" path="doseFormCode" scope="I" xsi:type="Property"/>
                        </expression>
                     </let>
                     <return localId="1308" locator="305:11-320:11">
                        <expression localId="1309" locator="305:18-320:11" xsi:type="Tuple">
                           <element name="rxNormCode">
                              <value localId="1311" locator="306:25-306:36" path="rxNormCode" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="doseFormCode">
                              <value localId="1313" locator="307:27-307:40" path="doseFormCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="doseQuantity">
                              <value localId="1314" locator="308:27-308:46" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="dosesPerDay">
                              <value localId="1316" locator="309:26-309:38" path="dosesPerDay" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="ingredientCode">
                              <value localId="1318" locator="310:29-310:44" path="ingredientCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="ingredientName">
                              <value localId="1320" locator="311:29-311:44" path="ingredientName" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="strength">
                              <value localId="1322" locator="312:23-312:32" path="strength" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="dailyDose">
                              <value localId="1323" locator="313:24-313:32" name="dailyDose" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="dailyDoseDescription">
                              <value localId="1338" locator="314:35-314:185" name="GetDailyDoseDescription" xsi:type="FunctionRef">
                                 <operand localId="1325" locator="314:59-314:74" path="ingredientCode" scope="I" xsi:type="Property"/>
                                 <operand localId="1327" locator="314:77-314:92" path="ingredientName" scope="I" xsi:type="Property"/>
                                 <operand localId="1329" locator="314:95-314:104" path="strength" scope="I" xsi:type="Property"/>
                                 <operand localId="1331" locator="314:107-314:120" path="doseFormCode" scope="I" xsi:type="Property"/>
                                 <operand localId="1333" locator="314:123-314:136" path="doseFormName" scope="I" xsi:type="Property"/>
                                 <operand localId="1334" locator="314:139-314:158" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                                 <operand localId="1336" locator="314:161-314:173" path="dosesPerDay" scope="M" xsi:type="Property"/>
                                 <operand localId="1337" locator="314:176-314:184" name="dailyDose" xsi:type="QueryLetRef"/>
                              </value>
                           </element>
                           <element name="conversionFactor">
                              <value localId="1339" locator="315:31-315:36" name="factor" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="mme">
                              <value localId="1340" locator="316:18-319:13" classType="t:Quantity" xsi:type="Instance">
                                 <element name="value">
                                    <value localId="1342" locator="317:22-317:45" xsi:type="Multiply">
                                       <signature localId="1346" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                       <signature localId="1347" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                                       <operand localId="1344" locator="317:22-317:36" path="value" xsi:type="Property">
                                          <source localId="1343" locator="317:22-317:30" name="dailyDose" xsi:type="QueryLetRef"/>
                                       </operand>
                                       <operand localId="1345" locator="317:40-317:45" name="factor" xsi:type="QueryLetRef"/>
                                    </value>
                                 </element>
                                 <element name="unit">
                                    <value localId="1354" locator="318:21-318:41" xsi:type="Concatenate">
                                       <operand localId="1350" locator="318:21-318:34" path="unit" xsi:type="Property">
                                          <source localId="1349" locator="318:21-318:29" name="dailyDose" xsi:type="QueryLetRef"/>
                                       </operand>
                                       <operand localId="1351" locator="318:38-318:41" valueType="t:String" value="/d" xsi:type="Literal"/>
                                    </value>
                                 </element>
                              </value>
                           </element>
                        </expression>
                     </return>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand localId="1276" name="medications">
            <operandTypeSpecifier localId="1268" locator="295:43-295:117" xsi:type="ListTypeSpecifier">
               <elementType localId="1269" locator="295:48-295:116" xsi:type="TupleTypeSpecifier">
                  <element localId="1270" locator="295:56-295:70" name="rxNormCode">
                     <elementType localId="1271" locator="295:67-295:70" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="1272" locator="295:73-295:93" name="doseQuantity">
                     <elementType localId="1273" locator="295:86-295:93" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="1274" locator="295:96-295:114" name="dosesPerDay">
                     <elementType localId="1275" locator="295:108-295:114" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>
